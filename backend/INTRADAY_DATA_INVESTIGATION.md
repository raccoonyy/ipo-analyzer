# 분봉 데이터 수집 가능성 조사 결과

## 📋 조사 개요

**목적**: 과거 IPO의 분봉(1분/5분) 데이터를 수집하여 모델 정확도 개선 가능성 조사

**조사 대상 API**:
1. yfinance (Yahoo Finance API)
2. KIS API (한국투자증권 OpenAPI)

**조사 기간**: 2025-10-08

---

## 🔍 yfinance 조사 결과

### 테스트 결과
- **상태**: ❌ 과거 분봉 데이터 수집 불가능
- **제한 사항**: 분봉 데이터는 **최근 30일 이내**만 제공
- **오류 메시지**:
  ```
  "1m data not available for startTime=1735171200 and endTime=1735225200.
  The requested range must be within the last 30 days."
  ```

### 테스트 케이스
| IPO | 종목코드 | 상장일 | 결과 |
|-----|---------|--------|------|
| 파인메딕스 | 387570 | 2024-12-26 | ❌ Empty (30일 초과) |
| 명인제약 | 317450 | 2025-09-24 | ✅ 168건 (30일 이내) |

### 주요 발견사항
- **30일 보관 한계**: Yahoo Finance는 1분/5분 데이터를 30일간만 보관
- **역사적 데이터 불가**: 2022-2024년 IPO 데이터는 접근 불가능
- **실시간 수집 필요**: 향후 IPO는 상장 즉시 수집해야 함

---

## 🔍 KIS API 조사 결과

### 테스트 결과
- **상태**: ❌ 과거 분봉 데이터 수집 불가능 (다른 이유)
- **제한 사항**: API가 날짜 파라미터를 **무시**하고 현재 데이터만 반환
- **오류 유형**: 요청 날짜와 다른 날짜의 데이터 반환

### 테스트 케이스

#### Test 1: 루닛 (2022-07-21 상장)
```
요청 날짜: 20220721 (2022년 7월 21일)
반환 날짜: 20251002 (2025년 10월 2일 - 현재)
결과: ❌ MISMATCH
```

#### Test 2: 파인메딕스 (2024-12-26 상장)
```
요청 날짜: 20241226
반환 날짜: 20251002 (현재)
결과: ❌ MISMATCH
```

#### Test 3: 명인제약 (2025-09-24 상장)
```
요청 날짜: 20250924
반환 날짜: 20251002 (현재)
결과: ❌ MISMATCH
```

### 주요 발견사항
- **날짜 파라미터 무효**: `FID_INPUT_HOUR_1` 파라미터가 역사적 날짜 지정에 사용되지 않음
- **현재 데이터만 제공**: 모든 요청에 대해 최근 거래일 데이터만 반환
- **API 스펙 한계**: 해당 엔드포인트는 일중 실시간 데이터 조회용으로 설계된 것으로 추정

### API 응답 샘플 (루닛, 2022-07-21 요청)
```json
{
  "stck_bsop_date": "20251002",  // 실제 데이터 날짜 (현재)
  "stck_cntg_hour": "20220700",  // 시간 (07:00?)
  "stck_prpr": "40750",          // 현재가
  "cntg_vol": "3894"             // 거래량
}
```

---

## 📊 결론 및 권장사항

### 🚫 불가능한 것
1. **yfinance**로 30일 이전 분봉 데이터 수집
2. **KIS API**로 과거 역사적 분봉 데이터 수집
3. 기존 282개 IPO(2022-2025)의 분봉 데이터 수집
4. 분봉 데이터를 활용한 역사적 모델 재학습

### ✅ 가능한 것
1. **향후 IPO**의 실시간 분봉 데이터 수집 (상장 즉시 시작)
2. **KIS API**로 현재/최근 일중 데이터 모니터링
3. **일별 OHLCV 데이터**를 활용한 현재 모델 유지 (이미 구현됨)

---

## 💡 최종 권장사항

### Option 1: 분봉 데이터 수집 포기 (권장 ✅)

**이유:**
- 현재 모델은 일별 데이터만으로 **R² 0.77** 달성
- 과거 데이터 수집이 불가능하여 모델 개선 효과 입증 불가
- 실시간 수집 시스템 구축 비용 대비 효과 불확실

**장점:**
- 개발 리소스 절약
- 기존 시스템 안정성 유지
- 즉시 프로덕션 배포 가능

**단점:**
- 분봉 데이터의 잠재적 예측력 활용 불가

---

### Option 2: 향후 IPO만 실시간 수집

**구현 방안:**
1. 신규 IPO 상장 알림 시스템 구축
2. 상장 즉시 KIS API로 분봉 데이터 수집 시작
3. 30일간 지속적으로 수집 (yfinance 한계 고려)
4. 충분한 샘플 축적 후(6개월~1년) 모델 개선 시도

**장점:**
- 미래 데이터부터 점진적으로 수집 가능
- 추후 모델 개선 기회 확보

**단점:**
- 실시간 수집 시스템 구축 필요 (복잡도 증가)
- 초기 몇 개월은 데이터 부족으로 효과 없음
- 상장 타이밍 놓치면 데이터 손실

---

### Option 3: 대안 데이터 소스 탐색

**검토 대상:**
- KRX 정보데이터시스템 (유료 API)
- 금융데이터 제공업체 (FnGuide, WISEfn 등)
- 증권사 고급 API (별도 계약 필요)

**장점:**
- 역사적 분봉 데이터 제공 가능성
- 데이터 품질 및 안정성 보장

**단점:**
- 비용 발생 (API 사용료)
- 별도 승인 및 계약 절차 필요
- 구현 시간 소요 (2-4주 예상)

---

## 📂 테스트 파일

### 생성된 파일
1. `test_kis_intraday_historical.py` - KIS API 역사적 데이터 테스트
2. `test_kis_intraday_date_verification.py` - 날짜 검증 테스트
3. `/tmp/test_kis_intraday.log` - 테스트 로그
4. `/tmp/test_kis_date_verify.log` - 검증 로그

### 재현 방법
```bash
# yfinance 테스트
uv run python -c "import yfinance as yf; print(yf.Ticker('387570.KQ').history(start='2024-12-26', end='2024-12-27', interval='1m'))"

# KIS API 테스트
uv run python test_kis_intraday_date_verification.py
```

---

## 🎯 우선순위 제안

1. **즉시**: Option 1 선택 - 분봉 데이터 수집 포기하고 현재 모델로 진행
2. **단기** (1-2주): 프론트엔드 완성 및 배포
3. **중기** (1-3개월): 사용자 피드백 수집, 모델 성능 모니터링
4. **장기** (6개월+): 필요시 Option 2 또는 3 재검토

---

## 📝 참고 문서

- yfinance 문서: https://github.com/ranaroussi/yfinance
- KIS OpenAPI 가이드: `src/api/kis_client.py`
- KRX API 연동 현황: `KRX_API_SETUP.md`

---

**작성일**: 2025-10-08
**작성자**: Claude Code
**버전**: 1.0
